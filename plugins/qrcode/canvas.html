<img id="thumb" src="#thumburl#" />
<div id="codetext" style="height:32px;"></div><br> 
<button  type="button" onclick="deqrcode()"  >二维码解码</button>
<script src="../../plugins/qrcode/jsQR.js" type="text/javascript"></script>
<script type="text/javascript">
    function deqrcode() {
		var image = new Image();
		image.src = document.getElementById("thumb").src;
		var canvas = document.createElement('canvas');
		image.onload = function () {
			var ctx = canvas.getContext('2d');
			canvas.width=image.width;
			canvas.height=image.height;
			ctx.drawImage(image, 0, 0); // 这里的x、y表示图像在canvas上的位置
			const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
			//console.log(canvas.width, canvas.height)
			// 将像素数据作为输入，使用 jsQR 库进行解码
			var data = imageData.data;
			var avg = 0;// 将彩色图片转换成黑白图片,三个通道的平均值，然后把这个平均值赋值给r, g, b
			 for( var i = 0; i < data.length; i += 4 ) {
				 avg = ( data[i] + data[i+1] + data[i+2] ) / 3;
				 data[i] = avg;
				 data[i+1] = avg;
				 data[i+2] = avg;
			 }
			const code = jsQR(data,canvas.width, canvas.height);
			document.getElementById("codetext").innerText= code.data;
			//console.log(code.data);
		};

    };

</script> 